# This CMake file was written to allow relatively easy Potrace compilation under MS Windows
# You should put it in main Potrace directory (directly above src)
# Tested only under MSVC 2013 & Potrace 1.11 

CMAKE_MINIMUM_REQUIRED(VERSION 2.8.1)
CMAKE_POLICY(VERSION 2.8.1)

SET(PROJECT_NAME libpotrace)

PROJECT(${PROJECT_NAME})
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY  ${CMAKE_SOURCE_DIR}/bin/lib)

SET(ROOT_DIR ${CMAKE_SOURCE_DIR})
SET(PROJECT_DIR ${ROOT_DIR}/src)

FILE (GLOB HEADERS ${PROJECT_DIR}/*.h)
FILE (GLOB SOURCES ${PROJECT_DIR}/*.c)

IF(NOT DEFINED AS_EXECUTABLE)
  LIST(REMOVE_ITEM SOURCES main.c)
  LIST(REMOVE_ITEM HEADERS main.h)
ENDIF(NOT DEFINED AS_EXECUTABLE)

INCLUDE_DIRECTORIES(${PROJECT_DIR})

ADD_LIBRARY(${PROJECT_NAME} ${SOURCES} ${HEADERS})  
ADD_DEFINITIONS(-DHAVE_STRING_H=1)

IF(MSVC)
  ADD_DEFINITIONS(-Dinline=__inline)
  ADD_DEFINITIONS(-D_USE_MATH_DEFINES)
ENDIF(MSVC)

ADD_DEFINITIONS(-DPOTRACE="\\"Potrace\\"")
ADD_DEFINITIONS(-DVERSION="\\"1.11\\"")
ADD_DEFINITIONS(-DMKBITMAP="\\"MkBitmap\\"")

SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES LINKER_LANGUAGE C)
SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES 
    LIBRARY_OUTPUT_DIRECTORY ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}
    ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_LIBRARY_OUTPUT_DIRECTORY})

GET_PROPERTY(libpotrace_location TARGET libpotrace PROPERTY LOCATION)
MESSAGE(STATUS "libpotrace location = ${libpotrace_location}")